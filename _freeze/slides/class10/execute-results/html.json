{
  "hash": "f0b33cb77e9d5cc1e91ea76c76d48b66",
  "result": {
    "markdown": "---\ntitle: \"A Quick Primer on Instrumental Variables\"\nauthor: \"Ian McCarthy, Emory University and NBER\"\ninstitute: \"Emory University, 2024\"\nformat: \n  revealjs:\n    theme: [simple, quarto-styles.scss]\n    preview-links: auto\n#    chalkboard:\n#      boardmarker-width: 5\n    slide-number: true\n    width: 1600\n    height: 900\n    embed-resources: true\nfrom: markdown+emoji\nexecute: \n  echo: true\nbibliography: ../files/bib/references.bib  \n---\n\n\n\n\n## Outline\n\n1. Assessing Selection on Unobservables\n2. Basics of Instrumental Variables\n3. Testing IV Assumptions\n4. Interpreting IV Results\n5. Common IV Designs Today\n\n\n\n# Assessing Selection on Unobservables\n\n---\n\n- Say we estimate a regression like $$y_{i} = \\delta D_{i} + \\beta_{1} x_{1i} + \\varepsilon_{i}$$\n- But we are concerned that the \"true\" specification is $$y_{i} = \\delta D_{i} + \\beta_{1} x_{1i} + \\beta_{2} x_{2i} + \\varepsilon_{i}$$\n- **Idea:** Extending the work of Altonji and others, Oster (2019) aims to decompose outome into a treatment effect ($\\delta$), observed controls ($x_{1}$), unobserved controls ($x_{2i}$), and iid error\n\n---\n\n## @oster2019\n\n**Key assumption:** Selection on observables is informative about selection on unobservables\n\n1. What is the maximum $R^2$ value we could obtain if we observed $x_{2}$? Call this $R_{\\text{max}}^{2}$ (naturally bounded above by 1, but likely smaller)\n2. What is the degree of selection on observed variables relative to unobserved variables? Denote the proportional relationship as $\\rho$ such that: $$\\rho \\times \\frac{Cov(x_{1},D)}{Var(x_{1})} = \\frac{Cov(x_{2},D)}{Var(x_{2})}.$$\n\n---\n\n## @oster2019\n\n- Under an \"equal relative contributions\" assumption, we can write:\n\n$$\\delta^{*} \\approx \\hat{\\delta}_{D,x_{1}} - \\rho \\times \\left[\\hat{\\delta}_{D} - \\hat{\\delta}_{D,x_{1}}\\right] \\times \\frac{R_{\\text{max}}^{2} - R_{D,x_{1}}^{2}}{R_{D,x_{1}}^{2} - R_{x_{1}}^{2}} \\xrightarrow{p} \\delta.$$\n\n- Consider a range of $R^{2}_{\\text{max}}$ and $\\rho$ to bound the estimated treatment effect,\n\n$$\\left[ \\hat{\\delta}_{D,x_{1}}, \\delta^{*}(\\bar{R}^{2}_{max}, \\rho) \\right]$$\n\n---\n\n## Augmented regression (somewhat out of place here)\n\n- Oster (2019) and similar papers can say something about how bad selection on unobservables would need to be\n- But what kind of \"improvement\" do we really get in practice?\n\n---\n\n- Original test from Hausman (1978) not specific to endogeneity, just a general misspecification test\n- Compare estimates from one estimator (efficient under the null) to another estimator that is consistent but inefficient under the null \n- In IV context, also known as Durbin-Wu-Hausman test, due to the series of papers pre-dating Hausman (1978), including Durbin and Wu in the 1950s\n\n---\n\n- Easily implemented as an \"artificial\" or \"augmented\" regression\n- We want to estimate $y=\\beta_{1}x_{1} + \\beta_{2}x_{2} + \\varepsilon$, with exogenous variables $x_{1}$, endogenous variables $x_{2}$, and instruments $z$\n    1. Regress each of the variables in $x_{2}$ on $x_{1}$ and $z$ and form residuals, $\\hat{v}$, $x_{2} = \\lambda_{x} x_{1} + \\lambda_{z} z + v$\n    2. Include $\\hat{v}$ in the standard OLS regression of $y$ on $x_{1}$, $x_{2}$, and $\\hat{v}$.\n    3. Test $H_{0}: \\beta_{\\hat{v}} = 0$. Rejection implies OLS is inconsistent.\n\n::: {.fragment}\nIntuition: Only way for $x_{2}$ to be correlated with $\\varepsilon$ is through $v$, **assuming $z$ is a \"good\" instrument**\n:::\n\n---\n\n## Summary\n\n- Do we have an endogeneity problem?\n    - Effects easily overcome by small selection on unobservables?\n    - Clear reverse causality problem?\n\n- What can we do about it?\n    - Matching, weighting, regression? Only for selection on observables\n    - DD, RD, differences in discontinuities? Specific designs and settings\n    - Instrumental variables? \n\n\n# Instrumental Variables\n\n---\n\n## What is instrumental variables\n\nInstrumental Variables (IV) is a way to identify causal effects using variation in treatment particpation that is due to an *exogenous* variable that is only related to the outcome through treatment.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![DAG Selection](class10_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n---\n\n## Simple example\n\n- $y = \\beta x + \\varepsilon (x)$, where $\\varepsilon(x)$ reflects the dependence between our observed variable and the error term.<br>\n\n- Simple OLS will yield $\\frac{dy}{dx} = \\beta + \\frac{d\\varepsilon}{dx} \\neq \\beta$\n\n\n---\n\n## What does IV do?\n\n- The regression we want to do: $$y_{i} = \\alpha + \\delta D_{i} + \\gamma A_{i} + \\epsilon_{i},$$\nwhere $D_{i}$ is treatment (think of schooling for now) and $A_{i}$ is something like ability.\n- $A_{i}$ is unobserved, so instead we run, $y_{i} = \\alpha + \\beta D_{i} + \\epsilon_{i}$\n- From this \"short\" regression, we don't actually estimate $\\delta$. Instead, we get an estimate of\n$$\\beta = \\delta + \\lambda_{ds}\\gamma \\neq \\delta,$$ where $\\lambda_{ds}$ is the coefficient of a regression of $A_{i}$ on $D_{i}$. \n\n---\n\n## Intuition\n\nIV will recover the \"long\" regression without observing underlying ability\n\n::: {.fragment}\n*IF* our IV satisfies all of the necessary assumptions.\n:::\n\n---\n\n## More formally\n\n- We want to estimate $$E[Y_{i} | D_{i}=1] - E[Y_{i} | D_{i}=0]$$\n- With instrument $Z_{i}$ that satisfies relevant assumptions, we can estimate this as\n$$E[Y_{i} | D_{i}=1] - E[Y_{i} | D_{i}=0] = \\frac{E[Y_{i} | Z_{i}=1] - E[Y_{i} | Z_{i}=0]}{E[D_{i} | Z_{i}=1] - E[D_{i} | Z_{i}=0]}$$\n- In words, this is effect of the instrument on the outcome (\"reduced form\") divided by the effect of the instrument on treatment (\"first stage\")\n\n---\n\n## Derivation\n\nRecall \"long\" regression: $Y=\\alpha + \\delta S + \\gamma A + \\epsilon$.\n\n$$\\begin{align}\nCOV(Y,Z) & = E[YZ] - E[Y] E[Z] \\\\\n         & = E[(\\alpha + \\delta S + \\gamma A + \\epsilon)\\times Z] - E[\\alpha + \\delta S + \\gamma A + \\epsilon)]E[Z] \\\\\n         & = \\alpha E[Z] + \\delta E[SZ] + \\gamma E[AZ] + E[\\epsilon Z] \\\\\n         & \\hspace{.2in} - \\alpha E[Z] - \\delta E[S]E[Z] - \\gamma E[A] E[Z] - E[\\epsilon]E[Z] \\\\\n         & = \\delta (E[SZ] - E[S] E[Z]) + \\gamma (E[AZ] - E[A] E[Z]) \\\\\n         & \\hspace{.2in} + E[\\epsilon Z] - E[\\epsilon] E[Z] \\\\\n         & = \\delta C(S,Z) + \\gamma C(A,Z) + C(\\epsilon, Z)\n\\end{align}$$\n\n---\n\n## Derivation\n\nWorking from $COV(Y,Z) = \\delta COV(S,Z) + \\gamma COV(A,Z) + COV(\\epsilon,Z)$, we find\n\n$$\\delta = \\frac{COV(Y,Z)}{COV(S,Z)}$$\n\nif $COV(A,Z)=COV(\\epsilon, Z)=0$\n\n---\n\n## IVs in practice\n\nEasy to think of in terms of randomized controlled trial...\n\n::: {.fragment}\n Measure    | Offered Seat | Not Offered Seat | Difference \n ---------- | ------------ | ---------------- | ---------- \n Score      | -0.003       | -0.358           | 0.355      \n % Enrolled | 0.787        | 0.046            | 0.741   \n Effect     |              |                  | 0.48\n\n\nAngrist *et al.*, 2012. \"Who Benefits from KIPP?\" *Journal of Policy Analysis and Management*.\n\n::: \n\n---\n\n## What is IV *really* doing\n\nThink of IV as two-steps:\n\n1. Isolate variation due to the instrument only (not due to endogenous stuff)\n2. Estimate effect on outcome using only this source of variation\n\n---\n\n## In regression terms\n\nInterested in estimating $\\delta$ from $y_{i} = \\alpha + \\beta x_{i} + \\delta D_{i} + \\varepsilon_{i}$, but $D_{i}$ is endogenous (no pure \"selection on observables\").\n\n::: {.fragment}\n**Step 1:** With instrument $Z_{i}$, we can regress $D_{i}$ on $Z_{i}$ and $x_{i}$,\n$$D_{i} = \\lambda + \\theta Z_{i} + \\kappa x_{i} + \\nu,$$\nand form prediction $\\hat{D}_{i}$.\n\n**Step 2:** Regress $y_{i}$ on $x_{i}$ and $\\hat{D}_{i}$, $$y_{i} = \\alpha + \\beta x_{i} + \\delta \\hat{D}_{i} + \\xi_{i}$$\n:::\n\n\n---\n\n## Derivation\n\nRecall $\\hat{\\theta}=\\frac{C(Z,S)}{V(Z)}$, or $\\hat{\\theta}V(Z) = C(S,Z)$. Then:\n\n$$\\begin{align}\n\\hat{\\delta}  & = \\frac{COV(Y,Z)}{COV(S,Z)} \\\\\n        & = \\frac{\\hat{\\theta}C(Y,Z)}{\\hat{\\theta}C(S,Z)} = \\frac{\\hat{\\theta}C(Y,Z)}{\\hat{\\theta}^{2}V(Z)} \\\\\n        & = \\frac{C(\\hat{\\theta}Z,Y)}{V(\\hat{\\theta}Z)} = \\frac{C(\\hat{S},Y)}{V(\\hat{S})}\n\\end{align}$$\n\n---\n\n## Animation for IV\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R Code\"}\ndf <- data.frame(Z = as.integer(1:200>100),\n                 W = rnorm(200)) %>%\n  mutate(X = .5+2*W +2*Z+ rnorm(200)) %>%\n  mutate(Y = -X + 4*W + 1 + rnorm(200),time=\"1\") %>%\n  group_by(Z) %>%\n  mutate(mean_X=mean(X),mean_Y=mean(Y),YL=NA,XL=NA) %>%\n  ungroup()\n\n#Calculate correlations\nbefore_cor <- paste(\"1. Start with raw data. Correlation between X and Y: \",round(cor(df$X,df$Y),3),sep='')\nafterlab <- '6. Draw a line between the points. The slope is the effect of X on Y.'\n\ndffull <- rbind(\n  #Step 1: Raw data only\n  df %>% mutate(mean_X=NA,mean_Y=NA,time=before_cor),\n  #Step 2: Add x-lines\n  df %>% mutate(mean_Y=NA,time='2. Figure out what differences in X are explained by Z'),\n  #Step 3: X de-meaned \n  df %>% mutate(X = mean_X,mean_Y=NA,time=\"3. Remove everything in X not explained by Z\"),\n  #Step 4: Remove X lines, add Y\n  df %>% mutate(X = mean_X,mean_X=NA,time=\"4. Figure out what differences in Y are explained by Z\"),\n  #Step 5: Y de-meaned\n  df %>% mutate(X = mean_X,Y = mean_Y,mean_X=NA,time=\"5. Remove everything in Y not explained by Z\"),\n  #Step 6: Raw demeaned data only\n  df %>% mutate(X =  mean_X,Y =mean_Y,mean_X=NA,mean_Y=NA,YL=mean_Y,XL=mean_X,time=afterlab))\n\n#Get line segments\nendpts <- df %>%\n  group_by(Z) %>%\n  summarize(mean_X=mean(mean_X),mean_Y=mean(mean_Y))\n\np <- ggplot(dffull,aes(y=Y,x=X,color=as.factor(Z)))+geom_point()+\n  geom_vline(aes(xintercept=mean_X,color=as.factor(Z)))+\n  geom_hline(aes(yintercept=mean_Y,color=as.factor(Z)))+\n  guides(color=guide_legend(title=\"Z\"))+\n  geom_segment(aes(x=ifelse(time==afterlab,endpts$mean_X[1],NA),\n                   y=endpts$mean_Y[1],xend=endpts$mean_X[2],\n                   yend=endpts$mean_Y[2]),size=1,color='blue')+\n  scale_color_colorblind()+\n  labs(title = 'The Relationship between Y and X, With Binary Z as an Instrumental Variable \\n{next_state}')+\n  transition_states(time,transition_length=c(6,16,6,16,6,6),state_length=c(50,22,12,22,12,50),wrap=FALSE)+\n  ease_aes('sine-in-out')+\n  exit_fade()+enter_fade()\n\nanimate(p,nframes=175)\n```\n\n::: {.cell-output-display}\n![](class10_files/figure-revealjs/unnamed-chunk-3-1.gif)\n:::\n:::\n\n\n---\n\n## Simulated data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- 5000\nb.true <- 5.25\niv.dat <- tibble(\n  z = rnorm(n,0,2),\n  eps = rnorm(n,0,1),\n  d = (z + 1.5*eps + rnorm(n,0,1) >0.25),\n  y = 2.5 + b.true*d + eps + rnorm(n,0,0.5)\n)\n```\n:::\n\n\n- endogenous `eps`: affects treatment and outcome\n- `z` is an instrument: affects treatment but no direct effect on outcome\n\n---\n\n## Results with simulated data\n\nRecall that the *true* treatment effect is 5.25\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ d, data = iv.dat)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.7806 -0.7061  0.0029  0.6757  3.9146 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  2.11415    0.01986   106.5   <2e-16 ***\ndTRUE        6.11795    0.02929   208.9   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1.032 on 4998 degrees of freedom\nMultiple R-squared:  0.8972,\tAdjusted R-squared:  0.8972 \nF-statistic: 4.363e+04 on 1 and 4998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nTSLS estimation, Dep. Var.: y, Endo.: d, Instr.: z\nSecond stage: Dep. Var.: y\nObservations: 5,000 \nStandard-errors: IID \n            Estimate Std. Error t value  Pr(>|t|)    \n(Intercept)  2.51950   0.029146 86.4443 < 2.2e-16 ***\nfit_dTRUE    5.23598   0.053196 98.4273 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1.12168   Adj. R2: 0.878546\nF-test (1st stage), dTRUE: stat = 2,789.0, p < 2.2e-16, on 1 and 4,998 DoF.\n               Wu-Hausman: stat =   562.8, p < 2.2e-16, on 1 and 4,997 DoF.\n```\n:::\n:::\n\n:::\n\n::::\n\n---\n\n## Two-stage equivalence\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R Code\"}\nstep1 <- lm(d ~ z, data=iv.dat)\nd.hat <- predict(step1)\nstep2 <- lm(y ~ d.hat, data=iv.dat)\nsummary(step2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ d.hat, data = iv.dat)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.0706 -2.1654 -0.1271  2.1690  8.6850 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  2.51950    0.07314   34.45   <2e-16 ***\nd.hat        5.23598    0.13349   39.22   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.815 on 4998 degrees of freedom\nMultiple R-squared:  0.2354,\tAdjusted R-squared:  0.2352 \nF-statistic:  1539 on 1 and 4998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n# Assumptions of IV\n\n---\n\n## Key IV assumptions\n\n1. *Exclusion:* Instrument is uncorrelated with the error term\n2. *Validity:* Instrument is correlated with the endogenous variable\n3. *Monotonicity:* Treatment more (less) likely for those with higher (lower) values of the instrument<br>\n\n::: {.fragment}\nAssumptions 1 and 2 sometimes grouped into an *only through* condition.\n:::\n\n\n---\n\n## Checking instrument\n\nBare minimum (probably not even that) is to check first stage and reduced form:\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n- Check the 'first stage'\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = d ~ z, data = iv.dat)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1.13046 -0.32500 -0.03084  0.33044  1.15203 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 0.462073   0.005648   81.81   <2e-16 ***\nz           0.146520   0.002774   52.81   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3993 on 4998 degrees of freedom\nMultiple R-squared:  0.3582,\tAdjusted R-squared:  0.358 \nF-statistic:  2789 on 1 and 4998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n- Check the 'reduced form'\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ z, data = iv.dat)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.0706 -2.1654 -0.1271  2.1690  8.6850 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  4.93891    0.03981  124.05   <2e-16 ***\nz            0.76718    0.01956   39.22   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2.815 on 4998 degrees of freedom\nMultiple R-squared:  0.2354,\tAdjusted R-squared:  0.2352 \nF-statistic:  1539 on 1 and 4998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n:::\n\n::::\n\n\n---\n\n## Do we need IV?\n\n- Let's run an \"augmented regression\" to see if our OLS results are sufficiently different than IV\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"R Code\"}\nd.iv <- lm(d ~ z, data=iv.dat)\nd.resid <- residuals(d.iv)\nhaus.test <- lm(y ~ d + d.resid, data=iv.dat)\nsummary(haus.test)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = y ~ d + d.resid, data = iv.dat)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-3.8854 -0.6626 -0.0009  0.6680  3.5515 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  2.51950    0.02542   99.10   <2e-16 ***\ndTRUE        5.23598    0.04640  112.84   <2e-16 ***\nd.resid      1.37413    0.05792   23.72   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.9786 on 4997 degrees of freedom\nMultiple R-squared:  0.9076,\tAdjusted R-squared:  0.9076 \nF-statistic: 2.455e+04 on 2 and 4997 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n- Test for significance of `d.resid` suggests OLS is inconsistent in this case\n\n\n---\n\n## Testing exclusion\n\n- Exclusion restriction says that your instrument does not directly affect your outcome\n- Potential testing ideas:\n  - \"zero-first-stage\" (subsample on which you know the instrument does not affect the endogenous variable)\n  - augmented regression of reduced-form effect with subset of instruments (overidentified models only)\n  - Sargan or Hansen's J test (null hypothesis is that instruments are uncorrelated with residuals)\n\n\n---\n\n## @vankippersluis2018, \"Beyond Plausibly Exogenous\"\n\n- \"zero-first-stage\" test\n- Focus on subsample for which your instrument is not correlated with the endogenous variable of interest\n    1. Regress the outcome on all covariates and the instruments among this subsample\n    2. Coefficient on the instruments captures any potential direct effect of the instruments on the outcome (since the correlation with the endogenous variable is 0 by assumption). \n\n---\n\n## @beckert2020, \"A Note on Specification Testing...\"\n\n- With at least $n$ valid instruments, test if all instruments are valid against the alternative that up to $m - n$ instruments are valid\n\n    1. Estimate the first-stage regressions and save residuals, denoted $\\hat{u}$. \n    2. Estimate the \"artificial\" regression $$y=\\beta x + \\delta \\tilde{z} + \\gamma \\hat{u} + \\varepsilon$$ where $\\tilde{z}$ denotes a subset of $m-n$ instruments from the full instrument matrix $z$. \n    3. Test the null that $\\delta=0$ using a standard F-test\n\n\n---\n\n## Solving an Exclusion Problem\n\n@conley2012 and \"plausible exogeneity\", union of confidence intervals approach:\n\n- Suppose extent of violation is known in $y_{i} = \\beta x_{i} + \\gamma z_{i} + \\varepsilon_{i}$, so that $\\gamma = \\gamma_{0}$\n- IV/TSLS applied to $y_{i} - \\gamma_{0}z_{i} = \\beta x_{i} + \\varepsilon_{i}$ works\n- With $\\gamma_{0}$ unknown...do this a bunch of times!\n    - Pick $\\gamma=\\gamma^{b}$ for $b=1,...,B$\n    - Obtain $(1-\\alpha)$ % confidence interval for $\\beta$, denoted $CI^{b}(1-\\alpha)$\n    - Compute final CI as the union of all $CI^{b}$\n\n\n---\n\n## Solving an Exclusion Problem\n\n@nevo2012:\n\n$$y_{i} = \\beta x_{i} + \\delta D_{i} + \\varepsilon_{i}$$\n\n- Allow instrument, $z$, to be correlated with $\\varepsilon$, but $|\\rho_{x, \\varepsilon}| \\geq |\\rho_{z, \\varepsilon}|$\n- i.e., IV is better than just using the endogenous variable\n- Assume $\\rho_{x, \\varepsilon} \\times \\rho_{z, \\varepsilon} >0$ (same sign of correlation in the error)\n- Denote $\\lambda = \\frac{\\rho_{z, \\varepsilon}}{\\rho_{x, \\varepsilon}}$, then valid $IV$ would be $V(z) = \\sigma_{x} z - \\lambda \\sigma_{z} x$\n- Can bound $\\beta$ using range of $\\lambda$\n\n---\n\n## Instrument Validity\n\nJust says that your instrument is correlated with the endogenous variable, but what about the **strength** of the correlation?\n\n![](https://media.giphy.com/media/3oFzlXvco5Wt2gnMcg/giphy.gif)\n\n\n---\n\n## Why we care about instrument strength\n\nRecall our schooling and wages equation, $$y = \\beta S + \\epsilon.$$ Bias in IV can be represented as:\n\n$$Bias_{IV} \\approx \\frac{Cov(S, \\epsilon)}{V(S)} \\frac{1}{F+1} = Bias_{OLS} \\frac{1}{F+1}$$\n\n- Bias in IV may be close to OLS, depending on instrument strength\n- **Bigger problem:** Bias could be bigger than OLS if exclusion restriction not *fully* satisfied\n\n---\n\n## Testing strength of instruments\n\nTwo things going on simultaneously:\n\n1. Strength of the first-stage\n2. Inference on coefficient of interest in the structural equation\n\n::: {.fragment}\nApplied researchers tend to (wrongly) think of these as separate issues.\n:::\n\n---\n\n## Testing strength of instruments\n\n**Many endogenous variables**\n\n- @stock2005 test based on Cragg & Donald statistic (homoskedasticity only)\n- @kleibergen2006 Wald statistic\n- @sanderson2016 extension\n- Effective F-statistic from @olea2013 (as approximation)\n\n\n---\n\n## Testing strength of instruments\n\n**Single endogenous variable**\n\n- Partial $R^{2}$ (never see this)\n- @stock2005 test based on first-stage F-stat (homoskedasticity only)\n    - Critical values in tables, based on number of instruments\n    - Rule-of-thumb of 10 with single instrument (higher with more instruments)\n    - @lee2021: With first-stage F-stat of 10, standard \"95% confidence interval\" for second stage is really an 85% confidence interval\n\n\n---\n\n## Testing strength of instruments\n\n**Single endogenous variable**\n\n- Partial $R^{2}$ (never see this)\n- @stock2005 test based on first-stage F-stat (homoskedasticity only)\n- @kleibergen2006 Wald statistic\n- Effective F-statistic from @olea2013\n\n---\n\n## Testing strength of instruments\n\n**Single endogenous variable**\n\n- Inference with Anderson-Rubin CIs (homoskedastic)\n- Inference with @lee2021 tables (allows for more general error structure)\n\n\n---\n\n## Testing strength of instruments: First-stage\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n**Single endogenous variable**\n\n1. Homoskedasticity: Stock & Yogo, effective F-stat\n2. Heteroskedasticity: Effective F-stat\n\n:::\n\n::: {.column width=\"50%\"}\n\n**Many endogenous variables**\n\n1. Homoskedasticity: Stock & Yogo with Cragg & Donald statistic, @sanderson2016, effective F-stat from @olea2013\n2. Heteroskedasticity: Kleibergen & Papp (@kleibergen2006) Wald is robust analog of Cragg & Donald statistic, effective F-stat from @olea2013\n\n:::\n\n::::\n\n---\n\n## Testing strength of instruments: Inference\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n**Single endogenous variable**\n\n1. Homoskedasticity: Anderson-Rubin CIs, Lee tF, likelihood ratio test from @moreira2003\n2. Heteroskedasticity: Lee tF, @lee2021\n\n:::\n\n::: {.column width=\"50%\"}\n\n**Many endogenous variables**\n\n1. Homoskedasticity: Projection-based confidence sets using the Anderson-Rubin CI (Dufour & Taamouti, 2005) but low power\n2. Heteroskedasticity: Go figure it out!\n\n:::\n\n::::\n\n\n---\n\n## Making sense of all of this...\n\n1. Test first-stage using effective F-stat\n2. Present weak-instrument-robust inference using Anderson-Rubin CIs or Lee tF tests\n\n::: {.fragment}\nMany endogenous variables problematic because strength of instruments for one variable need not imply strength of instruments for others\n:::\n\n\n# Interpreting Instrumental Variables Results\n\n---\n\n## Heterogenous TEs\n\n- In constant treatment effects, $Y_{i}(1) - Y_{i}(0) = \\delta_{i} = \\delta, \\text{ } \\forall i$\n- Heterogeneous effects, $\\delta_{i} \\neq \\delta$\n- With IV, what parameter did we just estimate? Need **monotonicity** assumption to answer this\n\n\n---\n\n## Monotonicity\n\nAssumption: Denote the effect of our instrument on treatment by $\\pi_{1i}$. Monotonicity states that $\\pi_{1i} \\geq 0$ or $\\pi_{1i} \\leq 0,  \\text{ } \\forall i$.\n\n- Allows for $\\pi_{1i}=0$ (no effect on treatment for some people)\n- All those affected by the instrument are affected in the same \"direction\"\n- With heterogeneous ATE and monotonicity assumption, IV provides a \"Local Average Treatment Effect\" (LATE)\n\n---\n\n## LATE and IV Interpretation\n\n- LATE is the effect of treatment among those affected by the instrument (compliers only).\n- Recall original Wald estimator:\n\n$$\\delta_{IV} = \\frac{E[Y_{i} | Z_{i}=1] - E[Y_{i} | Z_{i}=0]}{E[D_{i} | Z_{i}=1] - E[D_{i} | Z_{i}=0]}=E[Y_{i}(1) - Y_{i}(0) | \\text{complier}]$$\n\n- Practically, monotonicity assumes there are no defiers and restricts us to learning only about compliers\n\n---\n\n## Is LATE meaningful?\n\n- Learn about average treatment effect for compliers\n- Different estimates for different compliers\n    - IV based on merit scholarships\n    - IV based on financial aid\n    - Same compliers? Probably not\n\n---\n\n## LATE with defiers\n\n- In presence of defiers, IV estimates a weighted difference between effect on compliers and defiers (in general)\n- LATE can be restored if subgroup of compliers accounts for the same percentage as defiers and has same LATE\n- Offsetting behavior of compliers and defiers, so that remaining compliers dictate LATE\n\n    \n---\n\n## Marginal Treatment Effects\n\n- Lots of different treatment effects...ATT, ATU, LATE\n- Would be nice to have full distribution, $f(\\delta-{i})$, from which we could derive ATE, ATT, LATE, etc.\n- Marginal treatment effect (MTE) is nonparametric function that links all of these together\n    - Treatment effect, $\\delta_{i} = Y_{i}(1) - Y_{i}(0)$\n    - Treatment governed by index, $D_{i} = \\mathbb{1}(\\gamma z_{i} \\geq v_{i})$, with instruments $z$\n    \n$$\\delta^{MTE} (x, v_{i}) = E[\\delta_{i} | x_{i} = x, \\gamma z_{i} = v_{i}]$$\n\n\n---\n\n## Marginal Treatment Effects\n\n$$\\delta^{MTE} (x, v_{i}) = E[\\delta_{i} | x_{i} = x, \\gamma z_{i}=v_{i}]$$\n\n- $\\gamma z_{i} = v_{i}$ captures indifference between treatment and no treatment\n- Instead of number (like ATT or LATE), $\\delta^{MTE}(x,v)$ is a function of $v$\n- Average effect of treatment for everyone with the same $\\gamma z_{i}$\n\n---\n\n## Marginal Treatment Effects\n\nWhat is $\\gamma z_{i}$?\n\nFor any single index model:\n$$D_{i} = \\mathbb{1}(\\gamma z_{i} \\geq v_{i}) = \\mathbb{1}(u_{is} \\leq F(\\gamma z_{i})) \\text{ for } u_{is} \\in [0,1]$$\n\n- $F(\\gamma z_{i})$ is CDF of $v{i}$\n- Inverse CDF transform to translate into uniform distribution\n- Yields propensity score, $P(z_{i}) = Pr(D_{i}=1 | z_{i}) = F(\\gamma z_{i})$ (ranking all units according to probability of treatment)\n\n---\n\n## Marginal Treatment Effects\n\n- MTE is LATE as change in $z$ approaches 0 (Heckman, 1997)\n- MTE is Local IV:\n\n$$\\delta^{LIV} (x,p) = \\frac{\\partial E[Y | x, P(z)=p]}{\\partial p}$$\n\n- How does outcome $Y_{i}$ change as we push one more person into treatment\n\n---\n\n## Derivation\n\n$$\\begin{eqnarray*}\nY(0) &=& \\gamma_0 x + u_0\\\\\nY(1) &=& \\gamma_1 x + u_1\n\\end{eqnarray*}$$\n\n$P(D=1 | z) = P(z)$ works as our instrument with two assumptions:\n\n1. $(u_0, u_1, u_s) \\perp P(z) | x$. (Exogeneity)\n2. Conditional on $z$ there is enough variation in $z$ for $P(z)$ to take on all values $\\in(0,1)$.\n    - Much stronger than typical validity assumption, akin to special regressor in Lewbel's work\n    - Binary variable, $D=\\mathbb{1}(V+W^{*}\\geq 0)$. \"If $V$ is independent of $W$, then variation in $V$ changes the probability of $D=1$ in such a way that traces out the distribution of $W^{*}$\n    \n    \n---\n\n## Derivation\n\n- Now we can write,\n$$\\small \\begin{eqnarray*}\nY &=& \\gamma_0' x + D(\\gamma_1 - \\gamma_0)' x + u_0 + D(u_1 - u_0)\\\\\nE[Y| x,P(z)=p] &=& \\gamma_0' x + p(\\gamma_1 - \\gamma_0)'x + E[D(u_1 - u_0)|x,P(z)=p]\n\\end{eqnarray*}$$\n\n\n- Observe $D=1$ over the interval $u_s = [0,p]$ and zero for higher values of $u_s$. Let $u_1-u_0 \\equiv \\eta$.\n$$\\small \\begin{eqnarray*}\nE[D(u_1 - u_0) | P(z) =p,x] &=& \\int_{-\\infty}^{\\infty} \\int_{0}^{p} (u_1 - u_0) f((u_1-u_0) | u_s) d u_s d(u_1 -u_0)\\\\\nE[D(\\eta) | P(z) =p,x] &=& \\int_{-\\infty}^{\\infty} \\int_{0}^{p} \\eta f(\\eta | u_s)  d\\, \\eta d\\, u_s\\\\\n\\end{eqnarray*}$$\n\n\n---\n\n## Derivation\n\nRecall:\n$$\\begin{align*}\nE[Y| x,P(z)=p] &= \\gamma_0' X + p(\\gamma_1 - \\gamma_0)'X + E[D(u_1 - u_0)|x,P(z)=p]\\\\\n\\end{align*}$$\n\nAnd the derivative:\n$$\\begin{align*}\n\\delta^{MTE}(p) = \\frac{\\partial E[Y | x, P(z)=p]}{\\partial p} &= (\\gamma_1 - \\gamma_0)'x + \\int_{-\\infty}^{\\infty} \\eta f(\\eta | u_s =p) d\\, \\eta\\\\\n&= \\underbrace{(\\gamma_1 - \\gamma_0)'x}_{ATE(x)}+ E[\\eta | u_s =p]\n\\end{align*}$$\n\nWhat is $E[\\eta | u_s =p]$? The expected unobserved gain from treatment of those people who are on the treatment/no-treatment margin $P(z)=p$.\n\n---\n\n## MTE to ATE\n\nCalculate the outcome given $(x,z)$ (actually $z$ and $P(z)=p$).\n\n$$\\begin{align*}\n\\delta^{ATE}(x, T=1)&=E\\left(\\delta^{MTE} | X=x \\right)\\\\\n\\end{align*}$$\n\nATE: We treat everyone.\n$$\\begin{eqnarray*}\n\\int_{-\\infty}^{\\infty} \\delta^{MTE}(p) = (\\gamma_1 - \\gamma_0)'x + \\underbrace{\\int_{-\\infty}^{\\infty} E(\\eta | u_s) d\\, u_s}_{0}\n\\end{eqnarray*}$$\n\n---\n\n## MTE to ATT\n\nCalculate the outcome given $(x,z)$ (actually $z$ and $P(z)=p$).\n\n$$\\begin{align*}\n\\delta^{ATT}(x, P(z), T=1)&=E\\left(\\delta^{MTE} | X=x, u_{s} \\leq P(z)\\right)\\\\\n\\end{align*}$$\n\nATT: Treat only those with a large enough propensity score $P(z)>p$:\n$$\\begin{eqnarray*}\n\\int_{-\\infty}^{\\infty} \\delta^{MTE}(p,x) \\frac{Pr(P(z | x) > p)}{E[P(z | x)]} d\\,p\n\\end{eqnarray*}$$\n\n\n---\n\n## MTE to LATE\n\nCalculate the outcome given $(x,z)$ (actually $z$ and $P(z)=p$).\n\n$$\\begin{align*}\n\\delta^{L A T E}\\left(x, P(z), P\\left(z^{\\prime}\\right)\\right)&=E\\left(\\delta^{MTE} | X=x, P\\left(z^{\\prime}\\right) \\leq u_s \\leq P(z)\\right)\n\\end{align*}$$\n\nLATE: Integrate over the compliers:\n$$\\begin{eqnarray*}\nLATE(x,z,z')= \\frac{1}{P(z) - P(z')} \\int_{P(z')}^{P(z)} \\delta^{MTE}(p,x) \n\\end{eqnarray*}$$\n\n\n---\n\n## MTE to OLS and IV\n\nThis is harder...\n$$\\begin{align*}\nw^{I V}\\left(u_{s}\\right)=\\left[E\\left(P(z) | P(z)>u_{s}\\right)-E(P(z))\\right] \\frac{E(P(z))}{\\operatorname{Var}(P(z))}\\\\\nw^{O L S}\\left(u_{s}\\right)=1+\\frac{E\\left(u_{1} | u_{s}\\right) h_{1}-E\\left(u_{0} | u_{s}\\right) h_{0}}{\\delta^{M T E}\\left(u_{s}\\right)}\\\\\nh_{1}=\\frac{E\\left(P(z) | P(z)>u_{s}\\right)}{ E(P(z))}, \\quad h_{0}=\\frac{E\\left(P(z) | P(z)<u_{s}\\right)}{E(P(z))}\n\\end{align*}$$\n\n\n---\n\n## MTE in practice\n\n1. Estimate $P(z)= Pr(D=1 | z)$ nonparametrically ($z$ includes instruments and all exogenous $x$ variables)\n2. Flexible/nonparametric regression of $Y$ on $x$ and $P(z)$\n3. Differentiate w.r.t. $P(z)$\n4. Plot for all values of $P(z)=p$\n\nAs long as $P(z)$ covers $(0,1)$, we can trace out the full distribution of $\\delta^{MTE}(p)$\n\n---\n\n## Example\n\n[Grennan et al (2021)](https://www.stern.nyu.edu/sites/default/files/assets/documents/GMSC_nofreelunch.pdf)\n\n- Idea: what is the effect of detailing in prescription drugs (statins)\n- IV: Restrictions on detailing from conflict-of-interest policies imposed by large Academic Medical Centers...spillover to other hospitals\n- Estimate MTE and examine welfare effects in structural framework\n\n\n\n# Common IV Designs Today\n\n---\n\n## Judge Fixed Effects\n\n- Many different possible decision makers\n- Individuals randomly assigned to one decision maker\n- Decision makers differ in leniency of assigning treatment\n- Common in crime studies due to random assignment of judges to defendants\n\n---\n\n## Judge Fixed Effects\n\n@aizer2015, QJE, \"Juvenile Incarceration, Human Capital, and Future Crime: Evidence from Randomly Assigned Judges\"\n\n- Proposed instrument: propensity to convict by the judge\n- Idea: judge has some fixed leniency, and random assignment into judges introduces exogenous variation in probability of conviction\n- In practice: judge assignment isn't truly random, but it **is** plausibly exogenous\n\n---\n\n## Judge Fixed Effects\n\nConstructing the instrument:\n\n- Leave-one-out mean $$z_{j} = \\frac{1}{n_{j} - 1} \\sum_{k \\neq i}^{n_{j}-1} JI_{k}$$\n- This is the mean of incarceration rates for judge $j$ when excluding the current defendant, $i$\n- Could also residualize $JI_{k}$ (remove effects due to day of week, month, etc.)\n\n---\n\n## Judge Fixed Effects\n\n- Common design: possible in settings where some influential decision-makers exercise discretion and where individuals can't control the match\n- Practical issue: Use jackknife IV (JIVE) to \"fix\" small-sample bias\n    - JIVE more general than judge fixed effects design\n    - Idea: estimate first-stage without observation $i$, use coefficients for predicted endogeneous variable for observation $i$, repeat\n    - May improve finite-sample bias but also loses efficiency\n- Biggest threat: monotonicity...judges may be more/less lenient in different situations or for different defendants\n\n---\n\n## Bartik (shift-share) Instruments\n\n- Named after Timothy Bartik, traced back to Perlof (1957)\n- Original idea: Estimate effect of employment growth rates on labor-market outcomes\n    - Clear simultaneity problem\n    - Seek IV to shift labor demand\n\n---\n\n## Bartik Instruments\n\nDecompose observed growth rate into:\n\n1. \"Share\" (what extra growth would have occurred if each industry in an area grew at their industry national average)\n2. \"Shift\" (extra growth due to differential growth locally versus nationally)\n\n\n---\n\n## Bartik Instruments\n\n- Want to estimate $$y_{l} = \\alpha + \\delta I_{l} + \\beta w_{l} + \\varepsilon_{l}$$ for location $l$ (possibly time $t$ as well)\n- $I_{l}$ reflect immigration flows\n- $w_{l}$ captures other observables and region/time fixed effects\n\n\n---\n\n## Bartik Instruments\n\nInstrument:\n\n$$B_{l} = \\sum_{k=1}^{K} z_{l,k} \\Delta_{k},$$\n\n- $l$ denotes market location (e.g., Atlanta), country, etc. (wherever flows are coming *into*)\n- $k$ reflects the source country (where flows are coming out)\n- $z_{lk}$ denotes the **share** of immigrants from source $k$ in location $l$ (in a base period)\n- $\\Delta_{k}$ denotes the **shift** (i.e., change) from source country into the destination country as a whole (e.g., immigration into the U.S.)\n\n---\n\n## Other Examples\n\n$$\\begin{align}\nB_{l} &= \\sum_{k=1}^{K} z_{lk} \\Delta_{k},\\\\\n\\Delta_{lk} &= \\Delta_{k} + \\tilde{\\Delta_{lk}}\n\\end{align}$$\n\nChina shock @autor2013:\n\n- $z_{lk}$: location, $l$, and industry, $k$, composition\n- $\\Delta_{lk}$: location, $l$, and industry, $k$, growth in imports from China\n- $\\Delta_{k}$: industry $k$ growth of imports from China\n\n---\n\n## Other Examples\n\n$$\\begin{align}\nB_{l} &= \\sum_{k=1}^{K} z_{lk} \\Delta_{k},\\\\\n\\Delta_{lk} &= \\Delta_{k} + \\tilde{\\Delta_{lk}}\n\\end{align}$$\n\nImmigrant enclave (Altonji and Card, 1991):\n\n- $z_{lk}$: share of people from foreign country $k$ living in current location $l$ (in base period)\n- $\\Delta_{lk}$: growth in the number of people from $k$ to $l$\n- $\\Delta_{k}$: growth in people from $k$ nationally\n\n---\n\n## Other Examples\n\n$$\\begin{align}\nB_{l} &= \\sum_{k=1}^{K} z_{lk} \\Delta_{k},\\\\\n\\Delta_{lk} &= \\Delta_{k} + \\tilde{\\Delta_{lk}}\n\\end{align}$$\n\nMarket size and demography (Acemoglu and Linn, 2004):\n\n- $z_{lk}$: spending share on drug $l$ from age group $k$\n- $\\Delta_{lk}$: growth in spending of group $k$ on drug $l$\n- $\\Delta_{k}$: national growth in spending of group $k$ (e.g., due to population aging)\n\n\n---\n\n## Bartik Instruments\n\n- @goldsmith-pinkham2020 show that using $B_{l}$ as an instrument is equivalent to using local industry shares, $z_{lk}$, as IVs\n- Can decompose Bartik-style IV estimates into weighted combination of estimates where each share is an instrument (Rotemberg weights)\n- @borusyak2021restud, ReStud, instead focus on situation in which the shifts are exogenous and the shares are potentially endogenous\n- @borusyak2023, Econometrica, provide general approach when using exogenous shifts (recentering as in empirical exercise)\n\n\n**key:** literature was vague as to the underlying source of variation in the instrument...recent papers help in understanding this (and thus defending your strategy)\n\n---\n\n## Shift-Share (focusing on the shift)\n\n- Did ACA medicaid expansion affect insurance status?\n- Construct \"simulated\" IV (dummy for whether person $i$ is newly eligible given state expansion)\n- Instrument can be thought of as, $z_{is} = f(x_{i}, e_{s})$\n- Want to separate variation due to $e_{s}$ (the state policy changes) from variation in demographics, $x_{i}$\n    - Identify $p(x)$, probability of eligibility on average across other states' laws\n    - Recenter, $\\tilde{z}_{is} = z_{is} - p(x)$. Can also just control for $p(x)$ in regression.\n\n\n## References",
    "supporting": [
      "class10_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    // dispatch for htmlwidgets\r\n    function fireSlideEnter() {\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n    }\r\n\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n      fireSlideEnter();\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}